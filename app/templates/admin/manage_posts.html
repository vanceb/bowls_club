{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1 class="title">Manage Posts</h1>
    <p class="subtitle">Admin interface for managing news posts and announcements</p>
    
    <div class="box">
        <h2 class="title is-4">Posts ({{ posts|length }})</h2>
        
        {% if posts %}
        <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Author</th>
                        <th>Published</th>
                        <th>Expires</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for post in posts %}
                    <tr>
                        <td>
                            <a href="{{ url_for('main.post', post_id=post.id) }}">{{ post.title }}</a>
                        </td>
                        <td>{{ post.author.firstname }} {{ post.author.lastname }}</td>
                        <td>{{ post.publish_on }}</td>
                        <td>{{ post.expires_on }}</td>
                        <td>
                            {% set today = moment().format('YYYY-MM-DD') if moment else '2025-01-01' %}
                            {% if post.expires_on.strftime('%Y-%m-%d') >= today %}
                            <span class="tag is-success">Active</span>
                            {% else %}
                            <span class="tag is-warning">Expired</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="buttons are-small">
                                <a href="{{ url_for('admin.edit_post', post_id=post.id) }}" class="button is-primary is-small">
                                    <span class="icon">
                                        <i class="fas fa-edit"></i>
                                    </span>
                                    <span>Edit</span>
                                </a>
                                <button class="button is-danger is-small" onclick="deletePost({{ post.id }}, '{{ post.title }}')">
                                    <span class="icon">
                                        <i class="fas fa-trash"></i>
                                    </span>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="notification is-info">
            <p>No posts found.</p>
        </div>
        {% endif %}
    </div>
    
    <div class="field">
        <div class="control">
            <a href="{{ url_for('admin.write_post') }}" class="button is-primary">
                <span class="icon">
                    <i class="fas fa-plus"></i>
                </span>
                <span>Write Post</span>
            </a>
        </div>
    </div>
</div>

<!-- Hidden form for post deletion -->
<form method="POST" id="delete-post-form" style="display: none;">
    {{ csrf_form.hidden_tag() }}
</form>

<script>
function deletePost(postId, postTitle) {
    if (confirm(`Are you sure you want to delete the post "${postTitle}"?\n\nThis action cannot be undone and will move the post files to the archive.`)) {
        const form = document.getElementById('delete-post-form');
        form.action = `{{ url_for('admin.delete_post', post_id=0) }}`.replace('0', postId);
        form.submit();
    }
}
</script>
{% endblock %}