{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1 class="title">Upcoming Events</h1>
    <p class="subtitle">Register your interest in upcoming events. Event managers will create teams from the pool of registered members.</p>

    {% if events_data %}
    <!-- Group events by registration status -->
    {% set open_events = [] %}
    {% set registered_events = [] %}
    {% set withdrawn_events = [] %}
    {% set closed_events = [] %}
    
    {% for event_info in events_data %}
        {% if event_info.pool_open and event_info.registration_status == 'not_registered' %}
            {% set _ = open_events.append(event_info) %}
        {% elif event_info.registration_status == 'registered' %}
            {% set _ = registered_events.append(event_info) %}
        {% elif event_info.registration_status == 'withdrawn' and event_info.pool_open %}
            {% set _ = withdrawn_events.append(event_info) %}
        {% else %}
            {% set _ = closed_events.append(event_info) %}
        {% endif %}
    {% endfor %}

    <!-- Open for Registration Section -->
    {% if open_events %}
    <div class="box">
        <h3 class="title is-4 has-text-success">
            <span class="icon">
                <i class="fas fa-door-open"></i>
            </span>
            <span>Open for Registration ({{ open_events | length }})</span>
        </h3>
        <p class="subtitle is-6 has-text-grey">Events currently accepting registrations</p>
        
        <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
                <thead>
                    <tr>
                        <th style="width: 35%;">Event Details</th>
                        <th style="width: 20%;">Type/Format</th>
                        <th style="width: 12%;">Status</th>
                        <th style="width: 13%;">Registration</th>
                        <th style="width: 20%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event_info in open_events %}
                    {% set row_class = "has-background-success-light" %}
                    {% include 'partials/event_row.html' with context %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Your Registered Events Section -->
    {% if registered_events %}
    <div class="box">
        <h3 class="title is-4 has-text-info">
            <span class="icon">
                <i class="fas fa-users"></i>
            </span>
            <span>Registered Interest - Awaiting Team Selection ({{ registered_events | length }})</span>
        </h3>
        <p class="subtitle is-6 has-text-grey">Events you've registered interest in - event managers will select teams from the pool</p>
        
        <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
                <thead>
                    <tr>
                        <th style="width: 35%;">Event Details</th>
                        <th style="width: 20%;">Type/Format</th>
                        <th style="width: 12%;">Status</th>
                        <th style="width: 13%;">Registration</th>
                        <th style="width: 20%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event_info in registered_events %}
                    {% set row_class = "has-background-info-light" %}
                    {% include 'partials/event_row.html' with context %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Withdrawn Events Section -->
    {% if withdrawn_events %}
    <div class="box">
        <h3 class="title is-4 has-text-warning">
            <span class="icon">
                <i class="fas fa-user-times"></i>
            </span>
            <span>Withdrawn Events ({{ withdrawn_events | length }})</span>
        </h3>
        <p class="subtitle is-6 has-text-grey">Events you've withdrawn from but can still re-register</p>
        
        <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
                <thead>
                    <tr>
                        <th style="width: 35%;">Event Details</th>
                        <th style="width: 20%;">Type/Format</th>
                        <th style="width: 12%;">Status</th>
                        <th style="width: 13%;">Registration</th>
                        <th style="width: 20%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event_info in withdrawn_events %}
                    {% set row_class = "has-background-warning-light" %}
                    {% include 'partials/event_row.html' with context %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Closed Events Section -->
    {% if closed_events %}
    <div class="box">
        <h3 class="title is-4 has-text-grey">
            <span class="icon">
                <i class="fas fa-door-closed"></i>
            </span>
            <span>Closed Events ({{ closed_events | length }})</span>
        </h3>
        <p class="subtitle is-6 has-text-grey">Events that are no longer accepting registrations</p>
        
        <div class="table-container">
            <table class="table is-fullwidth is-striped is-hoverable">
                <thead>
                    <tr>
                        <th style="width: 35%;">Event Details</th>
                        <th style="width: 20%;">Type/Format</th>
                        <th style="width: 12%;">Status</th>
                        <th style="width: 13%;">Registration</th>
                        <th style="width: 20%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event_info in closed_events %}
                    {% set row_class = "" %}
                    {% include 'partials/event_row.html' with context %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% else %}
    <div class="box">
        <div class="notification is-info">
            <div class="content has-text-centered">
                <p class="title is-4">
                    <span class="icon is-large">
                        <i class="fas fa-calendar-plus"></i>
                    </span>
                </p>
                <p class="title is-5">No upcoming events with pools</p>
                <p>There are currently no events with pool registration available.</p>
                <p>Event managers will create events with pool registration when new competitions or games are planned.</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Summary Statistics -->
    {% if events_data %}
    <div class="box">
        <h3 class="title is-5">Summary</h3>
        <div class="columns">
            <div class="column">
                <div class="has-text-centered">
                    <p class="heading">Open for Registration</p>
                    <p class="title is-4 has-text-success">{{ open_events | length }}</p>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <p class="heading">Your Registrations</p>
                    <p class="title is-4 has-text-info">{{ registered_events | length }}</p>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <p class="heading">Withdrawn Events</p>
                    <p class="title is-4 has-text-warning">{{ withdrawn_events | length }}</p>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <p class="heading">Closed Events</p>
                    <p class="title is-4 has-text-grey">{{ closed_events | length }}</p>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <p class="heading">Total Events</p>
                    <p class="title is-4">{{ events_data | length }}</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}