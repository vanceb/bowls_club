{% extends "base.html" %}
{% set active_page = "bookings" %}

{% block title %}Manage Event: {{ booking.name }}{% endblock %}

{% block page_header %}
<h1 class="title">Manage Event</h1>
<h2 class="subtitle">{{ booking.name }}</h2>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Series Context Notification -->
    {% if booking.series_id and not is_primary_booking %}
    <div class="notification is-info is-light">
        <div class="columns is-vcentered">
            <div class="column">
                <p>
                    <span class="icon"><i class="fas fa-info-circle"></i></span>
                    <strong>Series Event:</strong> This is part of the "{{ booking.get_series_name() }}" series.
                    {% if effective_organizer %}
                        Series organizer: <strong>{{ effective_organizer.firstname }} {{ effective_organizer.lastname }}</strong>
                    {% endif %}
                </p>
                <p class="is-size-7 has-text-grey">
                    To change the organizer for the entire series, edit the primary event.
                </p>
            </div>
            <div class="column is-narrow">
                {% if primary_booking %}
                <a href="{{ url_for('bookings.admin_manage_booking', booking_id=primary_booking.id) }}" 
                   class="button is-primary">
                    <span class="icon"><i class="fas fa-star"></i></span>
                    <span>Go to Primary Booking</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <div class="box">
        <h3 class="title is-4">
            Event Details
            {% if booking.series_id %}
                : {{ booking.get_series_name() }}
            {% endif %}
        </h3>
                
                <form id="main-booking-form" method="POST">
                    {{ form.hidden_tag() }}
                    
                    <div class="tabs is-boxed">
                        <ul>
                            <li class="is-active" data-tab="event">
                                <a>
                                    <span class="icon is-small"><i class="fas fa-trophy" aria-hidden="true"></i></span>
                                    <span>Event Details</span>
                                </a>
                            </li>
                            <li data-tab="booking">
                                <a>
                                    <span class="icon is-small"><i class="fas fa-calendar" aria-hidden="true"></i></span>
                                    <span>This Booking</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Event Details Tab -->
                    <div class="tab-content is-active" data-content="event">
                        <div class="columns">
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.event_type.label }}</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            {{ form.event_type }}
                                        </div>
                                    </div>
                                    {% for error in form.event_type.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.format.label }}</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            {{ form.format }}
                                        </div>
                                    </div>
                                    {% for error in form.format.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="columns">
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.gender.label }}</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            {{ form.gender }}
                                        </div>
                                    </div>
                                    {% for error in form.gender.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.scoring.label }}</label>
                                    <div class="control">
                                        {{ form.scoring(class="input") }}
                                    </div>
                                    {% for error in form.scoring.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Event Details Actions -->
                        <div class="field is-grouped">
                            <div class="control">
                                <button type="submit" name="action" value="save_booking" class="button is-primary">
                                    <span class="icon">
                                        <i class="fas fa-save"></i>
                                    </span>
                                    <span>Save</span>
                                </button>
                            </div>
                            <div class="control">
                                <button type="submit" name="action" value="toggle_pool" class="button {% if booking.pool and booking.pool.is_open %}is-success{% elif booking.pool %}is-warning{% else %}is-light{% endif %}">
                                    <span class="icon">
                                        <i class="fas {% if booking.pool and booking.pool.is_open %}fa-users{% elif booking.pool %}fa-users-slash{% else %}fa-plus{% endif %}"></i>
                                    </span>
                                    <span>
                                        {% if booking.pool and booking.pool.is_open %}
                                            Pool Open
                                        {% elif booking.pool %}
                                            Pool Closed
                                        {% else %}
                                            Create Pool
                                        {% endif %}
                                    </span>
                                </button>
                            </div>
                        </div>
                        <p class="help">
                            {% if booking.pool and booking.pool.is_open %}
                                Pool is open for member registrations. Click pool button to close registration.
                            {% elif booking.pool %}
                                Pool is closed for new registrations. Click pool button to reopen.
                            {% else %}
                                Click pool button to create and open registration. Save button updates event details.
                            {% endif %}
                        </p>
                        
                        <!-- Series Management Section - For primary series bookings -->
                        {% if booking.series_id and is_primary_booking %}
                        <form method="POST" id="series-management-form" class="mt-5">
                            {{ form.hidden_tag() }}
                            <input type="hidden" name="action" value="save_series">
                        
                            <div class="card">
                                <div class="card-header">
                                    <p class="card-header-title">
                                        <span class="icon"><i class="fas fa-users-cog"></i></span>
                                        Series Management
                                    </p>
                                </div>
                                <div class="card-content">
                                    <!-- Series Name Field - Editable for primary bookings -->
                                    <div class="field">
                                        <label class="label">Series Display Name</label>
                                        <div class="control">
                                            {{ form.series_name(class="input", placeholder="Enter series name (e.g. Summer League 2024)") }}
                                        </div>
                                        {% for error in form.series_name.errors %}
                                            <p class="help is-danger">{{ error }}</p>
                                        {% endfor %}
                                        <p class="help">This name will be displayed for all events in this series.</p>
                                    </div>
                                    
                                    <!-- Series Organizer Field -->
                                    <div class="field">
                                        <label class="label">{{ form.organizer_id.label }}</label>
                                        <div class="control">
                                            <div class="select is-fullwidth">
                                                {{ form.organizer_id }}
                                            </div>
                                        </div>
                                        {% for error in form.organizer_id.errors %}
                                            <p class="help is-danger">{{ error }}</p>
                                        {% endfor %}
                                        <p class="help">The series organizer can manage all events in this series, including team selection and scheduling.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Series Management Actions -->
                            <div class="field is-grouped mt-3">
                                <div class="control">
                                    <button type="submit" class="button is-primary">
                                        <span class="icon">
                                            <i class="fas fa-save"></i>
                                        </span>
                                        <span>Save Series Changes</span>
                                    </button>
                                </div>
                                <div class="control">
                                    <form method="POST" style="display: inline;">
                                        {{ form.hidden_tag() }}
                                        <input type="hidden" name="action" value="delete_series">
                                        <button type="submit" class="button is-danger"
                                                onclick="return confirm('⚠️ DANGER: Delete entire series?\n\nThis will PERMANENTLY DELETE:\n• ALL {{ booking.get_series_bookings()|length }} events in this series\n• ALL associated pools and registrations\n• ALL team assignments\n\nThis action CANNOT be undone!\n\nType DELETE to confirm:') && prompt('Type DELETE to confirm series deletion:') === 'DELETE';">
                                            <span class="icon">
                                                <i class="fas fa-trash-alt"></i>
                                            </span>
                                            <span>Delete Entire Series</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </form>
                        {% endif %}
                    </div>
                    
                    <!-- This Booking Tab -->
                    <div class="tab-content" data-content="booking">
                        <!-- Event Name Field - First -->
                        <div class="field">
                            <label class="label">{{ form.name.label }}</label>
                            <div class="control">
                                {{ form.name(class="input") }}
                            </div>
                            {% for error in form.name.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                        
                        <!-- Opposition Field - Second -->
                        <div class="field">
                            <label class="label">{{ form.vs.label }}</label>
                            <div class="control">
                                {{ form.vs(class="input") }}
                            </div>
                            {% for error in form.vs.errors %}
                                <p class="help is-danger">{{ error }}</p>
                            {% endfor %}
                        </div>
                        
                        <div class="columns">
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.booking_date.label }}</label>
                                    <div class="control">
                                        {{ form.booking_date(class="input") }}
                                    </div>
                                    {% for error in form.booking_date.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.session.label }}</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            {{ form.session }}
                                        </div>
                                    </div>
                                    {% for error in form.session.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="columns">
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.rink_count.label }}</label>
                                    <div class="control">
                                        {{ form.rink_count(class="input") }}
                                    </div>
                                    {% for error in form.rink_count.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="column">
                                <div class="field">
                                    <label class="label">{{ form.home_away.label }}</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            {{ form.home_away }}
                                        </div>
                                    </div>
                                    {% for error in form.home_away.errors %}
                                        <p class="help is-danger">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Booking Actions -->
                        <div class="field is-grouped">
                            <div class="control">
                                <button type="submit" name="action" value="save_booking" class="button is-primary">
                                    <span class="icon">
                                        <i class="fas fa-save"></i>
                                    </span>
                                    <span>Save</span>
                                </button>
                            </div>
                            <div class="control">
                                <a href="{{ url_for('bookings.admin_manage_teams', booking_id=booking.id) }}" 
                                   class="button is-success">
                                    <span class="icon">
                                        <i class="fas fa-users"></i>
                                    </span>
                                    <span>Manage Teams for this Booking</span>
                                </a>
                            </div>
                            <div class="control">
                                <button type="button" class="button is-info" onclick="openDuplicateModal()">
                                    <span class="icon">
                                        <i class="fas fa-copy"></i>
                                    </span>
                                    <span>Duplicate</span>
                                </button>
                            </div>
                            <div class="control">
                                <a href="{{ url_for('bookings.admin_list_bookings') }}" class="button is-light">
                                    <span class="icon">
                                        <i class="fas fa-arrow-left"></i>
                                    </span>
                                    <span>Back to Events</span>
                                </a>
                            </div>
                            <div class="control">
                                {% if booking.series_id and is_primary_booking %}
                                    <button type="button" class="button is-danger" disabled title="Cannot delete primary booking. Use 'Delete Series' in Series Management tab to delete all events.">
                                        <span class="icon">
                                            <i class="fas fa-ban"></i>
                                        </span>
                                        <span>Cannot Delete Primary</span>
                                    </button>
                                {% else %}
                                    <button type="submit" form="delete-form" class="button is-danger"
                                            onclick="return confirm('Are you sure you want to delete this booking? This action cannot be undone.');">
                                        <span class="icon">
                                            <i class="fas fa-trash"></i>
                                        </span>
                                        <span>Delete Booking</span>
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                        
                    </div>
                    
                </form>
                
                <!-- Create Series Button - Only show for standalone bookings -->
                {% if not booking.series_id %}
                <div class="field is-grouped mt-3">
                    <div class="control">
                        <form method="POST" style="display: inline;">
                            {{ form.hidden_tag() }}
                            <input type="hidden" name="action" value="create_series">
                            <button type="submit" class="button is-info">
                                <span class="icon">
                                    <i class="fas fa-plus"></i>
                                </span>
                                <span>Create Series</span>
                            </button>
                        </form>
                    </div>
                </div>
                {% endif %}
                
                <!-- Hidden delete form for Delete Booking button -->
                <form id="delete-form" method="POST" action="{{ url_for('bookings.admin_delete_booking', booking_id=booking.id) }}" style="display: none;">
                    {{ form.hidden_tag() }}
                </form>
    </div>
</div>

<!-- Duplicate Modal -->
<div class="modal" id="duplicateModal">
    <div class="modal-background" onclick="closeDuplicateModal()"></div>
    <div class="modal-content">
        <div class="box">
            <h3 class="title is-4">Duplicate Event</h3>
            <p class="subtitle is-6">Modify the details for the duplicate event</p>
            
            <form id="duplicateForm" method="POST">
                {{ form.hidden_tag() }}
                <input type="hidden" name="action" value="duplicate">
                
                <div class="field">
                    <label class="label">Event Date</label>
                    <div class="control">
                        <input type="date" name="duplicate_date" id="duplicate_date" class="input" required 
                               value="{{ booking.booking_date.strftime('%Y-%m-%d') if booking.booking_date }}">
                    </div>
                </div>
                
                <div class="field">
                    <label class="label">Session</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="duplicate_session" id="duplicate_session" required>
                                {% for key, value in config.get('DAILY_SESSIONS', {}).items() %}
                                <option value="{{ key }}" {% if key == booking.session %}selected{% endif %}>{{ value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="field">
                    <label class="label">Venue</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="duplicate_venue" id="duplicate_venue">
                                <option value="">Select venue...</option>
                                {% for key, value in config.get('HOME_AWAY_OPTIONS', {}).items() %}
                                <option value="{{ value }}" {% if value == booking.home_away %}selected{% endif %}>{{ key }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="field">
                    <label class="label">Opposition Team</label>
                    <div class="control">
                        <input type="text" name="duplicate_opposition" id="duplicate_opposition" class="input" 
                               value="{{ booking.vs if booking.vs }}" placeholder="Enter opposition team name">
                    </div>
                </div>
                
                <div class="field is-grouped">
                    <div class="control">
                        <button type="submit" class="button is-primary">
                            <span class="icon">
                                <i class="fas fa-copy"></i>
                            </span>
                            <span>Create Duplicate</span>
                        </button>
                    </div>
                    <div class="control">
                        <button type="button" class="button" onclick="closeDuplicateModal()">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <button class="modal-close is-large" onclick="closeDuplicateModal()"></button>
</div>

<script>
// Configuration data from Flask
const EVENT_TYPES = {{ config.EVENT_TYPES | tojson }};
const EVENT_POOL_STRATEGY = {{ config.EVENT_POOL_STRATEGY | tojson }};

// Current booking state for proper initialization
const CURRENT_BOOKING = {
    series_id: "{{ booking.series_id or '' }}",
    series_name: "{{ booking.get_series_name() if booking.series_id else '' }}",
    series_count: {{ booking.get_series_bookings()|length if booking.series_id else 1 }},
    has_series: {{ 'true' if booking.series_id else 'false' }}
};

document.addEventListener('DOMContentLoaded', function() {
    // Tab switching functionality
    const tabs = document.querySelectorAll('.tabs li[data-tab]');
    const tabContents = document.querySelectorAll('.tab-content[data-content]');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const targetTab = this.getAttribute('data-tab');
            
            // Remove active class from all tabs and content
            tabs.forEach(t => t.classList.remove('is-active'));
            tabContents.forEach(content => content.classList.remove('is-active'));
            
            // Add active class to clicked tab and corresponding content
            this.classList.add('is-active');
            const targetContent = document.querySelector(`[data-content="${targetTab}"]`);
            if (targetContent) {
                targetContent.classList.add('is-active');
            }
        });
    });
    
    // Initialize series panel based on current event type
    initializeSeriesPanel();
    
    // Smart series automation - monitor event type changes
    const eventTypeDropdown = document.getElementById('event_type');
    if (eventTypeDropdown) {
        eventTypeDropdown.addEventListener('change', function() {
            updateSeriesPanel(parseInt(this.value));
        });
    }
    
    // Handle series action dropdown changes
    const seriesActionDropdown = document.getElementById('series_action');
    if (seriesActionDropdown) {
        seriesActionDropdown.addEventListener('change', function() {
            handleSeriesActionChange(this.value);
        });
    }
});

// Handle series action changes with conditional field display
function handleSeriesActionChange(action) {
    const seriesNameField = document.getElementById('seriesNameField');
    const existingSeriesField = document.getElementById('existingSeriesField');
    
    // Hide all conditional fields by default
    if (seriesNameField) seriesNameField.style.display = 'none';
    if (existingSeriesField) existingSeriesField.style.display = 'none';
    
    // Show relevant fields based on action
    switch (action) {
        case 'create_new':
            if (seriesNameField) seriesNameField.style.display = 'block';
            break;
        case 'join_existing':
            if (existingSeriesField) existingSeriesField.style.display = 'block';
            break;
        case 'no_change':
        case 'remove_series':
        default:
            // No additional fields needed
            break;
    }
    
    console.log('Series action changed to:', action);
}

// Update series status display
function updateSeriesStatusDisplay() {
    const statusText = document.getElementById('seriesStatusText');
    const statusDetails = document.getElementById('seriesStatusDetails');
    const statusIcon = document.querySelector('#currentSeriesStatus .icon i');
    
    if (!statusText || !statusDetails) return;
    
    if (CURRENT_BOOKING.has_series && CURRENT_BOOKING.series_id) {
        const seriesName = CURRENT_BOOKING.series_name;
        const eventCount = CURRENT_BOOKING.series_count;
        
        if (eventCount > 1) {
            statusText.textContent = `Part of "${seriesName}" series`;
            statusDetails.textContent = `This series contains ${eventCount} events in total`;
            if (statusIcon) {
                statusIcon.className = 'fas fa-copy fa-2x';
                statusIcon.parentElement.className = 'icon is-large has-text-success';
            }
        } else {
            statusText.textContent = `Only event in "${seriesName}" series`;
            statusDetails.textContent = 'This is the only event in this series';
            if (statusIcon) {
                statusIcon.className = 'fas fa-file fa-2x';
                statusIcon.parentElement.className = 'icon is-large has-text-warning';
            }
        }
    } else {
        statusText.textContent = 'Not part of any series';
        statusDetails.textContent = 'This event stands alone and is not part of a series';
        if (statusIcon) {
            statusIcon.className = 'fas fa-info-circle fa-2x';
            statusIcon.parentElement.className = 'icon is-large has-text-info';
        }
    }
}

function initializeSeriesPanel() {
    console.log('Initializing series panel with booking state:', CURRENT_BOOKING);
    
    // Initialize series panel based on current event type
    const eventTypeDropdown = document.getElementById('event_type');
    if (eventTypeDropdown && eventTypeDropdown.value) {
        updateSeriesPanel(parseInt(eventTypeDropdown.value));
    }
    
    // Update the series status display
    updateSeriesStatusDisplay();
    
    // Initialize the series action dropdown to "no_change"
    const seriesActionDropdown = document.getElementById('series_action');
    if (seriesActionDropdown) {
        seriesActionDropdown.value = 'no_change';
        handleSeriesActionChange('no_change');
        
        // Also call the status display update after a short delay to ensure DOM is ready
        setTimeout(updateSeriesStatusDisplay, 100);
    }
    
    // Ensure the series_id hidden field is properly set
    const seriesIdField = document.getElementById('series_id');
    if (seriesIdField && CURRENT_BOOKING.series_id) {
        seriesIdField.value = CURRENT_BOOKING.series_id;
    }
}

function updateSeriesPanel(eventTypeId) {
    const seriesPanel = document.getElementById('seriesPanel');
    const seriesStrategyTag = document.getElementById('seriesStrategyTag');
    const seriesInfoMessage = document.getElementById('seriesInfoMessage');
    
    if (!seriesPanel || !seriesStrategyTag) return;
    
    const strategy = EVENT_POOL_STRATEGY[eventTypeId] || 'none';
    const eventTypeName = getEventTypeName(eventTypeId);
    
    // Update strategy tag with more descriptive text
    const strategyText = getStrategyDescription(strategy);
    seriesStrategyTag.textContent = strategyText;
    seriesStrategyTag.className = 'tag ' + getStrategyTagClass(strategy);
    
    // Update tooltip for series panel header
    const seriesPanelToggle = document.getElementById('seriesPanelToggle');
    if (seriesPanelToggle) {
        seriesPanelToggle.title = `Click to expand series options. ${strategyText} for ${eventTypeName} events.`;
    }
    
    switch (strategy) {
        case 'event':
            // Competition, League, Other - auto-show and auto-expand
            seriesPanel.style.display = 'block';
            // Auto-expand panel for event strategy
            const seriesContent = document.getElementById('seriesContent');
            const seriesToggleIcon = document.getElementById('seriesToggleIcon');
            if (seriesContent) {
                seriesContent.classList.remove('is-hidden');
                if (seriesToggleIcon) {
                    seriesToggleIcon.innerHTML = '<i class="fas fa-chevron-down"></i>';
                }
                if (seriesPanelToggle) {
                    seriesPanelToggle.setAttribute('aria-expanded', 'true');
                }
            }
            // Update info message for event strategy
            if (seriesInfoMessage) {
                const messageBody = seriesInfoMessage.querySelector('.message-body .content');
                if (messageBody) {
                    messageBody.innerHTML = `
                        <p><strong>Recommended for ${eventTypeName} events:</strong></p>
                        <ul>
                            <li><strong>Event Strategy:</strong> Players register once for the entire series</li>
                            <li><strong>Shared Pool:</strong> Single pool for team selection across all events</li>
                            <li><strong>Easier Management:</strong> Manage recurring events as a unified group</li>
                            <li><strong>Player Convenience:</strong> Reduces repeated registration for regular participants</li>
                        </ul>
                    `;
                }
            }
            break;
            
        case 'booking':
            // Social, Friendly - show but collapsed
            seriesPanel.style.display = 'block';
            // Ensure panel starts collapsed for booking strategy
            const seriesContentBooking = document.getElementById('seriesContent');
            const seriesToggleIconBooking = document.getElementById('seriesToggleIcon');
            const seriesPanelToggleBooking = document.getElementById('seriesPanelToggle');
            if (seriesContentBooking) {
                seriesContentBooking.classList.add('is-hidden');
                if (seriesToggleIconBooking) {
                    seriesToggleIconBooking.innerHTML = '<i class="fas fa-chevron-right"></i>';
                }
                if (seriesPanelToggleBooking) {
                    seriesPanelToggleBooking.setAttribute('aria-expanded', 'false');
                }
            }
            // Update info message for booking strategy
            if (seriesInfoMessage) {
                const messageBody = seriesInfoMessage.querySelector('.message-body .content');
                if (messageBody) {
                    messageBody.innerHTML = `
                        <p><strong>Optional for ${eventTypeName} events:</strong></p>
                        <ul>
                            <li><strong>Booking Strategy:</strong> Each event typically has its own pool</li>
                            <li><strong>Series Option:</strong> Can still be useful for regular recurring events</li>
                            <li><strong>Flexibility:</strong> Players can register per event or for the series</li>
                            <li><strong>Use Case:</strong> Best for weekly social games or friendly matches</li>
                        </ul>
                    `;
                }
            }
            break;
            
        case 'none':
            // Roll Up - hide entirely
            seriesPanel.style.display = 'none';
            break;
    }
}

function getStrategyTagClass(strategy) {
    switch (strategy) {
        case 'event':
            return 'is-success';
        case 'booking':
            return 'is-info';
        case 'none':
            return 'is-light';
        default:
            return 'is-light';
    }
}

function getStrategyDescription(strategy) {
    switch (strategy) {
        case 'event':
            return 'Event Strategy - Recommended';
        case 'booking':
            return 'Booking Strategy - Optional';
        case 'none':
            return 'No Pool Strategy';
        default:
            return 'Unknown Strategy';
    }
}

function getEventTypeName(eventTypeId) {
    const typeNames = {
        1: 'Social',
        2: 'Competition', 
        3: 'League',
        4: 'Friendly',
        5: 'Roll Up',
        6: 'Other'
    };
    return typeNames[eventTypeId] || 'Unknown';
}

function toggleSeriesPanel() {
    const seriesContent = document.getElementById('seriesContent');
    const seriesToggleIcon = document.getElementById('seriesToggleIcon');
    const seriesPanelToggle = document.getElementById('seriesPanelToggle');
    
    if (!seriesContent || !seriesToggleIcon) return;
    
    if (seriesContent.classList.contains('is-hidden')) {
        // Expand with Bulma animation
        seriesContent.classList.remove('is-hidden');
        seriesToggleIcon.innerHTML = '<i class="fas fa-chevron-down"></i>';
        if (seriesPanelToggle) {
            seriesPanelToggle.setAttribute('aria-expanded', 'true');
        }
    } else {
        // Collapse with Bulma animation
        seriesContent.classList.add('is-hidden');
        seriesToggleIcon.innerHTML = '<i class="fas fa-chevron-right"></i>';
        if (seriesPanelToggle) {
            seriesPanelToggle.setAttribute('aria-expanded', 'false');
        }
    }
}

// Modal functions
function openDuplicateModal() {
    document.getElementById('duplicateModal').classList.add('is-active');
}

function closeDuplicateModal() {
    document.getElementById('duplicateModal').classList.remove('is-active');
}

</script>
{% endblock %}